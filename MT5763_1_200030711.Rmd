---
title: "MT5763_1_200030711"
author: "Alexander Curtis"
date: "03/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load libraries:
```{r, message = FALSE}
library(tidyverse)
library(lubridate)
library(gridExtra)
```

## Data wrangling

Data wrangling for the Seoul dataset:
```{r}
BikeSeoul <- read.csv("BikeSeoul.csv") %>% 
  # Remove unwanted columns
  select(-Visibility..10m.,
         -Dew.point.temperature.C.,
         -Solar.Radiation..MJ.m2., -Rainfall.mm.,
         -Snowfall..cm.) %>%
  # Keep only functioning days then remove column
  filter(Functioning.Day == "Yes") %>%
  select(-Functioning.Day) %>%
  rename(Count = Rented.Bike.Count, 
         Temperature = Temperature.C.,
         Humidity = Humidity...,
         WindSpeed = Wind.speed..m.s.,
         Season = Seasons) %>%
  mutate(Date = as.Date(Date, "%d/%m/%Y")) %>%
  mutate(FullDate = make_datetime(year = year(Date),
                                  month = month(Date),
                                  day = day(Date),
                                  hour = Hour)) %>%
  mutate(Holiday = factor(Holiday, 
                          levels = c("Holiday", "No Holiday"),
                          labels = c("Yes", "No"))) %>%
  mutate(Season = factor(Season, 
                         levels = c("Spring", "Summer", "Autumn", "Winter")))
```


Data wrangling for the Washington DC dataset:
```{r}
BikeWashingtonDC <- read.csv("BikeWashingtonDC.csv") %>%
  # Remove unwanted columns
  select(-instant,
         -yr,
         -mnth,
         -weekday,
         -workingday,
         -weathersit,
         -atemp,
         -casual,
         -registered) %>%
  rename(Date = dteday,
         Season = season,
         Hour = hr,
         Holiday = holiday,
         Temperature = temp,
         Humidity = hum,
         WindSpeed = windspeed,
         Count = cnt) %>%
  # Transform humidity into a percentage
  mutate(Humidity = Humidity * 100) %>%
  # Transform Temperature into degrees Celcius
  mutate(Temperature = 47 * Temperature - 8) %>%
  # Transform Windspeed into m/s
  mutate(WindSpeed = WindSpeed * 67) %>%
  mutate(Season = factor(Season,
                         levels = c(2, 3, 4, 1),
                         labels = c("Spring", "Summer", "Autumn", "Winter"))) %>%
  mutate(Holiday = factor(Holiday,
                          levels = c(1, 0),
                          labels = c("Yes", "No"))) %>%
  mutate(Date = as.Date(Date, "%Y-%m-%d")) %>%
  mutate(FullDate = make_datetime(year = year(Date),
                                  month = month(Date),
                                  day = day(Date),
                                  hour = Hour))
```


## Data Visualisation

### How does air temperature vary over the course of a year?

To get a good sense of how the air temperature changes, a plot has been created which shows the mean temperature for every day within the Seoul dataset.
```{r, message = FALSE}
BikeSeoul %>% 
  group_by(Date) %>%
  summarise(DailyMean = mean(Temperature)) %>%
  ggplot() +
  geom_line(aes(x = Date, y = DailyMean)) +
  ylab("Temperature (ºC)") +
  ggtitle("Mean Daily Air Temperature in Seoul")
```
This plot shows that the temperature is fairly low in the winter months but then climbs steadily through the year to a peak just over 30ºC around August. The temperature then falls at a similar rate to how it climbed as it falls back to around 0ºC.
The same plot has been created for the Washington DC dataset, but with just one of the two years selected so that it is easier to compare with Seoul.
```{r, message = FALSE}
BikeWashingtonDC %>% 
  filter(year(Date) == 2011) %>%
  group_by(Date) %>%
  summarise(DailyMean = mean(Temperature)) %>%
  ggplot() +
  geom_line(aes(x = Date, y = DailyMean)) +
  ylab("Temperature (ºC)") +
  ggtitle("Mean Daily Air Temperature in Washington DC")
```
The Washington plot follows a very similar trend to the one for Seoul. It also climbs steadily from 0ºC around January to just over 30ºC in August and then falls back steadily. The main difference between the plots is that the daily temperature variation is a lot higher in Washington. This can be seen by the sharp peaks and troughs every few days, whereas the Seoul temperature seems a lot more consistent, especially in the later half of the year.

### Do seasons affect the average number of rented bikes?

This question is best answered by creating a bar chart of the counts for each season and comparing.
```{r, message = FALSE}
p1 <- BikeSeoul %>%
  group_by(Season) %>%
  summarise(meanCount = mean(Count)) %>%
  ggplot() + 
  geom_col(aes(x = Season, y = meanCount)) + 
  ylab("Count") +
  ggtitle("Seoul")
p2 <- BikeWashingtonDC %>%
  group_by(Season) %>%
  summarise(meanCount = mean(Count)) %>%
  ggplot() + 
  geom_col(aes(x = Season, y = meanCount)) + 
  ylab("Count") +
  ggtitle("Washington DC")
grid.arrange(p1, p2, ncol = 2, top = "Average Hourly Bike Rental")
```
The plots show a similar pattern in that summer is the season with the highest average number of bike rentals, and winter is the season with the lowest. Winter is particularly low for the Seoul dataset, with only a third the number of the next lowest - spring. Autumn is the second most popular season in Seoul whereas spring is in Washington DC. However it is much closer between spring and autumn in Washington DC than it is in Seoul.

### Do holidays increase or decrease the demand for rented bikes?

```{r}
p1 <- ggplot(BikeSeoul) +
  geom_boxplot(aes(x = Holiday, y = Count)) +
  ggtitle("Seoul")
p2 <- ggplot(BikeWashingtonDC) +
  geom_boxplot(aes(x = Holiday, y = Count)) +
  ggtitle("Washington DC")
grid.arrange(p1, p2, ncol = 2, top = "Hourly Bike Rental")
```

### How does the time of day affect the demand for rented bikes?

```{r}
p1 <- BikeSeoul %>%
  group_by(Hour) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() +
  geom_line(aes(x = Hour, y = MeanCount)) +
  xlab("Time of Day") +
  ylab("Demand for Bikes") +
  ggtitle("Seoul")
p2 <- BikeWashingtonDC %>%
  group_by(Hour) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() +
  geom_line(aes(x = Hour, y = MeanCount)) +
  xlab("Time of Day") +
  ylab("Demand for Bikes") +
  ggtitle("Washington DC")
grid.arrange(p1, p2, nrow = 2, top = "Average Hourly Demand for Bikes")
```

### Is there an association between bike demand and the three meteorological variables?

#### Air Temperature
```{r}
p1 <- BikeSeoul %>%
  group_by(Temperature) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = Temperature, y = MeanCount)) +
  xlab("Temperature (ºC)") +
  ylab("Bike Demand") +
  ggtitle("Seoul")
p2 <- BikeWashingtonDC %>%
  group_by(Temperature) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = Temperature, y = MeanCount)) +
  xlab("Temperature (ºC)") +
  ylab("Bike Demand") +
  ggtitle("Washington DC")
grid.arrange(p1, p2, top = "Average Hourly Demand for Bikes")
```

#### Wind Speed
```{r}
p1 <- BikeSeoul %>%
  group_by(WindSpeed) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = WindSpeed, y = MeanCount)) +
  xlab("Wind Speed (m/s)") +
  ylab("Bike Demand") +
  ggtitle("Seoul")
p2 <- BikeWashingtonDC %>%
  group_by(WindSpeed) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = WindSpeed, y = MeanCount)) +
  xlab("Wind Speed (m/s)") +
  ylab("Bike Demand") +
  ggtitle("Washington DC")
grid.arrange(p1, p2, top = "Average Hourly Demand for Bikes")
```

#### Humidity
```{r}
p1 <- BikeSeoul %>%
  group_by(Humidity) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = Humidity, y = MeanCount)) +
  xlab("Humidity (%)") +
  ylab("Bike Demand") +
  ggtitle("Seoul")
p2 <- BikeWashingtonDC %>%
  group_by(Humidity) %>%
  summarise(MeanCount = mean(Count)) %>%
  ggplot() + 
  geom_point(aes(x = Humidity, y = MeanCount)) +
  xlab("Humidity (%)") +
  ylab("Bike Demand") +
  ggtitle("Washington DC")
grid.arrange(p1, p2, top = "Average Hourly Demand for Bikes")
```



## Statistical Modelling

```{r}
SeoulLM <- lm(log(Count) ~ Season + Temperature + Humidity + WindSpeed,
              data = BikeSeoul)
summary(SeoulLM)
```

```{r}
WashingtonDCLM <- lm(log(Count) ~ Season + Temperature + Humidity + WindSpeed,
              data = BikeWashingtonDC)
summary(WashingtonDCLM)
```

```{r}
confint(SeoulLM, level = 0.97)
```
```{r}
confint(WashingtonDCLM, level = 0.97)
```

```{r}
dfPred <- data.frame(Season = "Winter",
             Temperature = 0,
             WindSpeed = 0.5,
             Humidity = 0.2)
logPred <- predict(SeoulLM,
        newdata = dfPred,
        interval = "prediction",
        level = 0.9)
exp(logPred)
```
```{r}
logPred <- predict(WashingtonDCLM,
        newdata = dfPred,
        interval = "prediction",
        level = 0.9)
exp(logPred)
```